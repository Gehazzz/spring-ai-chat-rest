<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${chat != null} ? 'Borisov GPT ‚Äî ' + chat.title : 'Borisov GPT'">Borisov GPT</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/chat.css}" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script defer th:src="@{/js/chat.js}"></script>
</head>
<body class="comic-body">
<div class="chat-container">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-top">
            <h1>Borisov GPT</h1>

            <!-- Model selection -->
            <div class="dropdown">
                <label for="model">–ú–æ–¥–µ–ª—å:</label>
                <select id="model">
                    <option>gemma3:4b-it-q4_K_M</option>
                    <option>LLama</option>
                </select>
            </div>

            <!-- Mode toggle -->
            <div class="toggle-mode">
                <label for="mode-toggle">–†–µ–∂–∏–º:</label>
                <span>Chat / RAG</span>
                <input type="checkbox" id="mode-toggle">
            </div>

            <!-- Chat list -->
            <div class="chat-list-wrapper">
                <ul class="chat-list">
                    <li th:each="c : ${chats}"
                        th:classappend="${chat != null and chat.id != null and c.id == chat.id} ? 'active' : ''">
                        <a th:href="@{/chat/{id}(id=${c.id})}">
                            <span th:text="${c.title}">–ß–∞—Ç</span>
                        </a>
                        <!-- –§–æ—Ä–º–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–∞—Ç–∞ -->
                        <form th:action="@{/chat/{id}/delete(id=${c.id})}" method="post"
                              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —á–∞—Ç?');">
                            <button type="submit" class="delete-chat-btn">‚úï</button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>

        <!-- New chat form -->
        <div class="sidebar-bottom">
            <form action="/chat/new" method="post" class="new-chat-form">
                <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞" required />
                <button type="submit" class="new-chat">üí• BOOM! –ù–æ–≤—ã–π —á–∞—Ç</button>
            </form>
            <a th:href="@{/config}" class="config-link">‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</a>
        </div>
    </aside>

    <!-- Chat main section -->
    <main class="chat-main">
        <div class="messages" id="messages">
            <div th:if="${chat != null}" th:each="entry : ${chatHistory}"
                 th:class="${entry.role == 'user'} ? 'message user' : 'message mentor'">
                <img th:src="${entry.role == 'user'} ? '/images/user.png' : '/images/mentor.png'" alt="avatar">
                <div class="bubble" th:text="${entry.content}">–ü—Ä–∏–º–µ—Ä —Ç–µ–∫—Å—Ç–∞</div>
            </div>
        </div>

        <div th:if="${chat != null}">
            <form th:action="@{/chat/{chatId}/entry(chatId=${chat.id})}" method="post" class="input-area">
                <div class="input-bubble">
                    <label for="chat-input" class="sr-only">–°–ø—Ä–∞—à–∏–≤–∞–π</label>
                    <textarea id="chat-input" name="content" placeholder="–°–ø—Ä–∞—à–∏–≤–∞–π..." required></textarea>
                    <input type="hidden" name="role" value="user" />
                    <button type="button" id="send-button">SEND!</button>
                </div>
            </form>
        </div>
    </main>
</div>
</body>
</html>
